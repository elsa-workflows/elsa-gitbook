{
  "$schema": "https://json-schema.org/draft-07/schema#",
  "description": "Example Elsa Identity configuration. DO NOT commit secrets to source control. Use environment variables or secret managers instead.",
  
  "Elsa": {
    "Identity": {
      "Providers": [
        {
          "Type": "ApiKey",
          "Name": "ApiKeyProvider",
          "Options": {
            "ApiKeys": [
              {
                "Key": "${API_KEY_ADMIN}",
                "Roles": ["Admin"],
                "Description": "Administrative API key - ROTATE QUARTERLY"
              },
              {
                "Key": "${API_KEY_SERVICE}",
                "Roles": ["Service"],
                "Description": "Service account for CI/CD and automation"
              }
            ]
          }
        },
        {
          "Type": "Jwt",
          "Name": "JwtProvider",
          "Options": {
            "Issuer": "https://your-identity-provider.com",
            "Audience": "elsa-workflows",
            "Authority": "https://your-identity-provider.com",
            "SigningKey": "${JWT_SIGNING_KEY}",
            "ValidateIssuer": true,
            "ValidateAudience": true,
            "ValidateLifetime": true,
            "ValidateIssuerSigningKey": true,
            "ClockSkew": "00:05:00"
          }
        },
        {
          "Type": "Oidc",
          "Name": "OidcProvider",
          "Options": {
            "Authority": "https://login.microsoftonline.com/${TENANT_ID}/v2.0",
            "ClientId": "${OIDC_CLIENT_ID}",
            "ClientSecret": "${OIDC_CLIENT_SECRET}",
            "ResponseType": "code",
            "Scope": "openid profile email elsa_api",
            "CallbackPath": "/signin-oidc",
            "SignedOutCallbackPath": "/signout-callback-oidc",
            "SaveTokens": true,
            "GetClaimsFromUserInfoEndpoint": true
          }
        }
      ],
      
      "TokenOptions": {
        "AccessTokenLifetime": "01:00:00",
        "RefreshTokenLifetime": "7.00:00:00",
        "BookmarkResumeTokenLifetime": "1.00:00:00",
        "Issuer": "elsa-workflows",
        "Audience": "elsa-api",
        "SigningKey": "${TOKEN_SIGNING_KEY}"
      }
    },
    
    "Http": {
      "BaseUrl": "https://your-elsa-server.com",
      "BasePath": "/elsa"
    }
  },
  
  "ConnectionStrings": {
    "DefaultConnection": "${DB_CONNECTION_STRING}"
  },
  
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Elsa": "Information",
      "Microsoft.AspNetCore": "Warning"
    },
    "Console": {
      "FormatterName": "json",
      "FormatterOptions": {
        "IncludeScopes": true,
        "TimestampFormat": "yyyy-MM-dd HH:mm:ss"
      }
    },
    "SafeFields": [
      "WorkflowInstanceId",
      "ActivityType",
      "Status",
      "Timestamp"
    ],
    "RedactedFields": [
      "Input",
      "Output",
      "Variables",
      "Payload",
      "ApiKey",
      "Token"
    ]
  },
  
  "Cors": {
    "AllowedOrigins": [
      "https://your-studio.com",
      "https://your-app.com"
    ],
    "AllowedMethods": ["GET", "POST", "PUT", "DELETE"],
    "AllowedHeaders": ["Content-Type", "Authorization"],
    "AllowCredentials": false,
    "MaxAge": 3600
  },
  
  "RateLimit": {
    "EnableRateLimiting": true,
    "Rules": [
      {
        "Endpoint": "POST:/elsa/api/bookmarks/resume",
        "Period": "1m",
        "Limit": 100,
        "PerIp": true
      },
      {
        "Endpoint": "*",
        "Period": "1m",
        "Limit": 1000,
        "PerIp": true
      }
    ]
  },
  
  "_comments": {
    "secrets": "Replace all ${VARIABLE} placeholders with environment variables or load from secret manager",
    "rotation": "Rotate API keys quarterly and JWT signing keys annually",
    "tls": "Always use HTTPS in production. Configure TLS 1.2+ with strong ciphers",
    "cors": "Never use AllowAnyOrigin in production. Whitelist specific origins only",
    "logging": "Ensure SafeFields and RedactedFields are configured to prevent PII leakage"
  }
}
